/*
Copyright (c) 2019 Daybrush
name: @scenejs/media
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/@scenejs/media.git
version: 0.1.0
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("scenejs")):"function"==typeof define&&define.amd?define(["scenejs"],t):(e=e||self).MediaScene=t(e.Scene)}(this,function(e){"use strict";var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function r(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var s=function(n){function e(e){var t=n.call(this)||this;return t.isPlayMedia=!1,t.init(e),t}r(e,n);var t=e.prototype;return t.getMediaItem=function(){return this.mediaItem},t.getVolume=function(){return this.mediaItem.get(0,"volume")},t.setVolume=function(e){return this.mediaItem.set(0,"volume",e),this},t.setPlaySpeed=function(e){return this.mediaItem.setPlaySpeed(e),this},t.seek=function(e,t){var n=this.mediaItem;return n.set(0,"seek",e),n.set("100%","seek",t),n.setDuration(t-e),this},t.setElement=function(e){return this.mediaItem.setElement(e),this},t.getInfo=function(){var e=this.mediaItem,t=[e.get(0,"seek"),e.get("100%","seek")],n=e.getPlaySpeed(),i=this.getVolume(),r=this.getDelay();return{url:this.url,seek:t,playSpeed:n,delay:r,volume:i}},t.init=function(e){var m=this,d=this.newItem("media");if(d.newFrame(0),d.newFrame(1),this.mediaItem=d,function(e){return"string"==typeof e}(e)){var t=new Audio;t.src=e,this.setElement(t),this.url=e}else{if(e.src)this.url=e.src;else{var n=e.querySelector("[src]");this.url=n?n.src:""}this.setElement(e)}var h=0;this.on("pause",function(e){var t=d.getElements()[0];m.isPlayMedia=!1,t.pause()}),this.on("animate",function(e){var t=d.getElements()[0],n=e.time,i=n<h,r="running"===m.getPlayState(),s=-1<m.getDirection().indexOf("reverse"),o=m.isPlayMedia,a=e.frames.media,u=d.getPlaySpeed(),c=m.getDuration(),f=m.getVolume(),l=a.get("seek");h=n,i||n<=0||c<=n?r&&(m.isPlayMedia=!1,t.pause()):(t.volume=f,r&&o||(t.playbackRate=u*(s?-1:1),t.currentTime=l),!o&&r&&(m.isPlayMedia=!0,t.play()))})},e}(e);return function(t){function e(){var e=t.call(this)||this;return e.playInfos={},e}r(e,t);var n=e.prototype;return n.addMedia=function(e,t){void 0===t&&(t=e);var n=new s(t);return this.setItem(e,n),n},n.getInfo=function(){var t={duration:0,medias:[]};return this.forEach(function(e){t.medias.push(e.getInfo())}),t.duration=this.getDuration(),t},e}(e)});
