/*
Copyright (c) 2019 Daybrush
name: media-scene
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/media-scene.git
version: 0.0.3
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("scenejs")):"function"==typeof define&&define.amd?define(["scenejs"],t):(e=e||self).MediaScene=t(e.Scene)}(this,function(e){"use strict";var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};return function(i){function e(e,t,n){var o=i.call(this)||this;return o.playInfos={},o.setDuration(e),o.load(t,n),o.init(),o}!function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(e,i);var t=e.prototype;return t.getInfo=function(){var t={};return this.forEach(function(r,e){var a={};r.times.forEach(function(e){var t=r.getFrame(e),n=t.get("seek"),o=t.get("playSpeed")||1,i=t.get("volume")||1;a[e]={seek:n,playSpeed:o,volume:i}}),t[e]=a}),t},t.init=function(){var t=this,n=this.playInfos;this.on("animate",function(e){var p=e.time,y="running"===t.getPlayState();t.forEach(function(c,e){!n[e]&&(n[c.getId()]={});var l=n[e];c.times.forEach(function(e){var t=c.elements[0];if(t){!l[e]&&(l[e]={isPlay:!1});var n=l[e],o=c.getFrame(e),i=o.get("seek"),r=i[0],a=i[1],f=o.get("playSpeed")||1;if(e+(a-r)/f<p)y&&(n.isPlay=!1,t.pause());else if(p<e)n.isPlay=!1;else if(!n.isPlay){var s=(p-e)*f,u=o.get("volume")||1;t.currentTime=r+(s<.01?0:s),t.playbackRate=f,t.volume=u,y&&(n.isPlay=!0,t.play())}}})})})},e}(e)});
