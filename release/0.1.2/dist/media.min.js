/*
Copyright (c) 2019 Daybrush
name: @scenejs/media
license: MIT
author: Daybrush
repository: git+https://github.com/daybrush/@scenejs/media.git
version: 0.1.2
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("scenejs")):"function"==typeof define&&define.amd?define(["scenejs"],t):(e=e||self).MediaScene=t(e.Scene)}(this,function(e){"use strict";var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function r(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var s=function(n){function e(e){var t=n.call(this)||this;return t.isPlayMedia=!1,t.init(e),t}r(e,n);var t=e.prototype;return t.getMediaItem=function(){return this.mediaItem},t.getVolume=function(){return this.mediaItem.get(0,"volume")},t.setVolume=function(e){return this.mediaItem.set(0,"volume",e),this},t.setPlaySpeed=function(e){return this.mediaItem.setPlaySpeed(e),this},t.seek=function(e,t){var n=this.mediaItem;return n.set(0,"seek",e),n.set("100%","seek",t),n.setDuration(t-e),this},t.setElement=function(e){return this.mediaItem.setElement(e),this},t.getInfo=function(){var e=this.mediaItem,t=[e.get(0,"seek"),e.get("100%","seek")],n=e.getPlaySpeed(),i=this.getVolume(),r=this.getDelay();return{url:this.url,seek:t,playSpeed:n,delay:r,volume:i}},t.init=function(e){var d=this,h=this.newItem("media");if(h.newFrame(0),h.newFrame(1),h.set(0,"volume",1),h.set(0,"seek",0),h.set("100%","seek",0),this.mediaItem=h,function(e){return"string"==typeof e}(e)){var t=new Audio;t.src=e,this.setElement(t),this.url=e}else{if(e.src)this.url=e.src;else{var n=e.querySelector("[src]");this.url=n?n.src:""}this.setElement(e)}var p=0;this.on("paused",function(e){var t=h.getElements()[0];d.isPlayMedia=!1,t.pause()}),this.on("animate",function(e){var t=h.getElements()[0],n=e.time,i=n<p,r="running"===d.getPlayState(),s=-1<d.getDirection().indexOf("reverse"),o=d.isPlayMedia,a=e.frames.media,u=h.getPlaySpeed(),c=d.getDuration(),l=d.getVolume(),f=a.get("seek");if(p=n,r&&o||(t.playbackRate=u*(s?-1:1),t.currentTime=f,console.log(f,t.currentTime)),i||n<=0||c<=n)r&&(d.isPlayMedia=!1,t.pause());else if(t.volume=l,!o&&r){d.isPlayMedia=!0;var m=t.play();m instanceof Promise&&m.catch(function(){t.muted=!0,t.play()})}})},e}(e);return function(t){function e(){var e=t.call(this)||this;return e.playInfos={},e}r(e,t);var n=e.prototype;return n.addMedia=function(e,t){void 0===t&&(t=e);var n=new s(t);return this.setItem(e,n),n},n.getInfo=function(){var t={duration:0,medias:[]};return this.forEach(function(e){t.medias.push(e.getInfo())}),t.duration=this.getDuration(),t},e}(e)});
